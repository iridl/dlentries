\begin{ingrid}
/description (AMJJA Forecasts) def

  continuedataset:

datasetdefs:

grid:
/name /provcode2 def
%/units /ids def
values: 1401. 1481. 1411. 1427. 1432. 1444. 128. 129. 133. 155. 209. 215. 231. 250. 257. 377. 308. 314. 349. 354. 369. 371. 410. 421. 434. 456. 458. 1740. 1751. 1752. 1753. 1759. 505. 516. 517. 520. 541. 562. 604. 606. 619. 679. 630. 645. 712. 722. 746. 761. 878. 826. 837. 848. 864. 860. 972. 973. 97332. 983. 99701. 1013. 1018. 1035. 1042. 1043. 1123. 1124. 1125. 1182. 1247. 1280. 1263. 1265. 1602. 1603. 1667. 1668. 1685. 1507. 1536. 1538. 1566. 1570.
:values
/long_name (Province Code) def
:grid

grid:
/name /provcode def
%/units /ids def
values: 1401. 1481. 1411. 1427. 1432. 1444. 128. 129. 133. 155. 209. 215. 231. 250. 257. 377. 308. 314. 349. 354. 369. 371. 410. 421. 434. 456. 458. 1740. 1751. 1752. 1753. 1759. 505. 516. 517. 520. 541. 562. 604. 606. 619. 679. 630. 645. 712. 722. 746. 761. 878. 826. 837. 848. 864. 860. 972. 973. 983. 1013. 1018. 1035. 1042. 1043. 1123. 1124. 1125. 1182. 1247. 1280. 1263. 1265. 1602. 1603. 1667. 1668. 1507. 1536. 1538. 1566. 1570.
:values
/long_name (Province Code) def
:grid

grid:
/name /mycol def
1 1 2
:grid

:datasetdefs

50.0 /percentile_D3 parameter
pop

Ingrid:

/prob_percentile_exc_rain {
startcolormap DATA 0 1 RANGE transparent black RGBdup 0 VALUE brown /percentile_D3 get_parameter interp 100. div -1. mul 1. add /probref parameter 0.05 sub 3. div VALUE orange /probref get_parameter 0.05 sub 3. div 2. mul VALUE yellow /probref get_parameter 0.05 sub VALUE moccasin RGBdup /probref get_parameter 0.05 add bandmax LimeGreen /probref get_parameter 0.05 add 0.005 add VALUE turquoise /probref get_parameter 0.05 add 2. mul 1. add 3. div VALUE blue /probref get_parameter 0.05 add 2. add 3. div VALUE purple 1 VALUE purple endcolormap
}defcolorscale

/prob_percentile_nonexc_rain {
startcolormap DATA 0 1 RANGE transparent purple RGBdup 0 VALUE blue /percentile_D3 get_parameter interp 100. div /probref parameter 0.05 sub 3. div VALUE turquoise /probref get_parameter 0.05 sub 3. div 2. mul VALUE LimeGreen /probref get_parameter 0.05 sub VALUE moccasin RGBdup /probref get_parameter 0.05 add bandmax yellow /probref get_parameter 0.05 add 0.005 add VALUE orange /probref get_parameter 0.05 add 2. mul 1. add 3. div VALUE brown /probref get_parameter 0.05 add 2. add 3. div VALUE black 1 VALUE black endcolormap
}defcolorscale

pop

  dataset:
  /name /History def
  /description (Predicand, Hindcast and Skill) def

datasetdefs:

grid:
/name /provcode2 def
%/units /ids def
values: 1401. 1481. 1411. 1427. 1432. 1444. 128. 129. 133. 155. 209. 215. 231. 250. 257. 377. 308. 314. 349. 354. 369. 371. 410. 421. 434. 456. 458. 1740. 1751. 1752. 1753. 1759. 505. 516. 517. 520. 541. 562. 604. 606. 619. 679. 630. 645. 712. 722. 746. 761. 878. 826. 837. 848. 864. 860. 972. 973. 97332. 983. 99701. 1013. 1018. 1035. 1042. 1043. 1123. 1124. 1125. 1182. 1247. 1280. 1263. 1265. 1602. 1603. 1667. 1668. 1685. 1507. 1536. 1538. 1566. 1570.
:values
/long_name (Province Code) def
:grid

grid:
/name /provcode def
%/units /ids def
values: 1401. 1481. 1411. 1427. 1432. 1444. 128. 129. 133. 155. 209. 215. 231. 250. 257. 377. 308. 314. 349. 354. 369. 371. 410. 421. 434. 456. 458. 1740. 1751. 1752. 1753. 1759. 505. 516. 517. 520. 541. 562. 604. 606. 619. 679. 630. 645. 712. 722. 746. 761. 878. 826. 837. 848. 864. 860. 972. 973. 983. 1013. 1018. 1035. 1042. 1043. 1123. 1124. 1125. 1182. 1247. 1280. 1263. 1265. 1602. 1603. 1667. 1668. 1507. 1536. 1538. 1566. 1570.
:values
/long_name (Province Code) def
:grid

grid:
/name /mycol def
1 1 2
:grid

:datasetdefs

grid:
/name /gid def
values:
66
71
67
68
69
70
2
3
4
5
7
8
9
10
11
18
12
13
14
15
16
17
19
20
21
22
23
81
82
83
84
85
24
25
26
27
28
29
30
31
32
35
33
34
36
37
38
39
45
40
41
42
44
43
46
47
48
49
50
51
52
53
54
55
56
57
58
61
59
60
77
78
79
80
72
73
74
75
76
:values
:grid
	
%		grid:
%		 /name /C def
%		 /units /ids def
%		 /long_name (Tercile Classes) def
%		 values: (Below Normal) (Normal) (Above Normal) :values
%		:grid
		
    grid:
      /name /S def
      monthtime
      /long_name (Start time) def
      /standard_name (forecast_reference_time) def
      /defaultvalue { last } def
      /pointwidth 0 def
        1 May 1950  ensotime
        1
        1 Apr 2007 ensotime
   :grid

/hindcast_date {
S
grid:
/name /Lc def
13.5 -1 2.5
:grid
0. add
/name /L def
Lc
S 12 splitgrid pop replaceGRID
add
/long_name (hindcast time) def
/pointwidth 5 def
/units (months since 1960-01-01) def
} defasvar

/PearsonR_WD5 {
      [ mycol provcode2 | S 12 splitgrid pop ]
    (/data/simon/WFP/Philippines/2008%m[S]/Skill_wet5_AMJJA_S%m[S].txt)  [S 12 splitgrid pop] 
      readdatafile:
        [3 0] r*8astsv 
      :readdatafile
mycol second VALUE
mycol removeGRID
provcode2 provcode SAMPLE
provcode2 gid replaceGRID
        /long_name (WD5 Pearson's Correlation) def
        /units (unitless) def
        /missing_value -9999. def
        correlationcolorscale
DATA -1 1 RANGE
    }defasvarsilent

/CrossValPred_WD5 {
      [ provcode2 S 12 splitgrid nip | S 12 splitgrid pop ]
(/data/simon/WFP/Philippines/2008%m[S]/CrossValPred_wet5_AMJJA_S%m[S].txt) [S 12 splitgrid pop]
	  readdatafile:
        [3 1] r*8astsv
      :readdatafile
S2 -12 shiftGRID
[S S2]REORDER
%[provcode2] REORDER
S unsplitstreamgrid
S /pointwidth 0 def pop
provcode2 provcode SAMPLE
provcode2 gid replaceGRID
        /long_name (WD5 cross-validated hindcasts) def
        /units /days def
        /missing_value -9999. def
wetday_freq_colors
DATA 0 AUTO RANGE
    }defasvarsilent
	
/Input_WD5 {
      [ provcode2 S 12 splitgrid nip | S 12 splitgrid pop ]
(/data/simon/WFP/Philippines/2008%m[S]/YInput_wet5_AMJJA_S%m[S].txt) [S 12 splitgrid pop]
          readdatafile:
        [3 1] r*8astsv
      :readdatafile
S2 -12 shiftGRID
[S S2]REORDER
%[provcode2] REORDER CopyStream
S unsplitstreamgrid
S /pointwidth 0 def pop
provcode2 provcode SAMPLE
provcode2 gid replaceGRID
        /long_name (WD5 input observations) def
        /units /days def
        /missing_value -9999. def
wetday_freq_colors
DATA 0 AUTO RANGE
    }defasvarsilent

/the_geom {
SOURCES .Features .Political .Philippines .Provinces
    .the_geom
%     :a: .provcode :a
%    use_as_grid
%   provcode  VoP_IP .provcode 
%SAMPLE
%.gridvalues VALUES
%defivars
%provcode /units /ids def pop
}defasvar

/label {
SOURCES .Features .Political .Philippines .Provinces
    .label
%     :a: .provcode :a
%    use_as_grid
%   provcode VoP_IP .provcode .gridvalues VALUES
%provcode /units /ids def pop
}defasvar

/provname {
SOURCES .Features .Political .Philippines .Provinces
    .provname
%     :a: .provcode :a
%    use_as_grid
%   provcode VoP_IP .provcode .gridvalues VALUES
%provcode /units /ids def pop
}defasvar

/regcode {
SOURCES .Features .Political .Philippines .Provinces
    .regcode
%     :a: .provcode :a
%    use_as_grid
%   provcode VoP_IP .provcode .gridvalues VALUES
%provcode /units /ids def pop
}defasvar

  	:dataset

  dataset:
	/name /Forecast def
	/description (Forecast and Error) def
	
datasetdefs:

grid:
/name /provcode2 def
%/units /ids def
values: 1401. 1481. 1411. 1427. 1432. 1444. 128. 129. 133. 155. 209. 215. 231. 250. 257. 377. 308. 314. 349. 354. 369. 371. 410. 421. 434. 456. 458. 1740. 1751. 1752. 1753. 1759. 505. 516. 517. 520. 541. 562. 604. 606. 619. 679. 630. 645. 712. 722. 746. 761. 878. 826. 837. 848. 864. 860. 972. 973. 97332. 983. 99701. 1013. 1018. 1035. 1042. 1043. 1123. 1124. 1125. 1182. 1247. 1280. 1263. 1265. 1602. 1603. 1667. 1668. 1685. 1507. 1536. 1538. 1566. 1570.
:values
/long_name (Province Code) def
:grid

grid:
/name /provcode def
%/units /ids def
values: 1401. 1481. 1411. 1427. 1432. 1444. 128. 129. 133. 155. 209. 215. 231. 250. 257. 377. 308. 314. 349. 354. 369. 371. 410. 421. 434. 456. 458. 1740. 1751. 1752. 1753. 1759. 505. 516. 517. 520. 541. 562. 604. 606. 619. 679. 630. 645. 712. 722. 746. 761. 878. 826. 837. 848. 864. 860. 972. 973. 983. 1013. 1018. 1035. 1042. 1043. 1123. 1124. 1125. 1182. 1247. 1280. 1263. 1265. 1602. 1603. 1667. 1668. 1507. 1536. 1538. 1566. 1570.
:values
/long_name (Province Code) def
:grid

:datasetdefs

grid:
/name /gid def
values:
66
71
67
68
69
70
2
3
4
5
7
8
9
10
11
18
12
13
14
15
16
17
19
20
21
22
23
81
82
83
84
85
24
25
26
27
28
29
30
31
32
35
33
34
36
37
38
39
45
40
41
42
44
43
46
47
48
49
50
51
52
53
54
55
56
57
58
61
59
60
77
78
79
80
72
73
74
75
76
:values
:grid

		grid:
		 /name /C def
		 /units /ids def
		 /long_name (Tercile Classes) def
		 values: (Below Normal) (Normal) (Above Normal) :values
		:grid

    grid:
      /name /S def
      monthtime
      /long_name (Start time) def
      /standard_name (forecast_reference_time) def
      /defaultvalue { last } def
      /pointwidth 0 def
values:
        1 Jan 2008  ensotime
        1
%        1 Jan 2016 ensotime
        systemtime
        systemtime2ymd
        ymd:lastmonth
        ymd:nextmonth 15 add
        ymd2rm1960
%        16 Jan 2009 ensotime
        {} for
      :values
    :grid

S { (/data/simon/WFP/Philippines/%Y%m[S]/Forecasts_wet5_AMJJA_S%Y%m[S].txt) [S] } removeextrausing
      /expires
        systemtime
        last_modified sub
        86400 lt {
          null
        }{
          last_modified
          systemtime2ymd pop dup 12 lt {
            1 add
          }{
            pop 1 add 1
          }ifelse
          6 ymd2systemtime
        }ifelse
      def
   name exch def

/expires S .expires def
		
/target_date {
S
grid:
/name /Lc def
values:
5.5 4.5 3.5 2.5 13.5 12.5 11.5 10.5 9.5 8.5 7.5 6.5
:values
:grid
0. add
/name /L def
Lc
S 12 splitgrid pop replaceGRID
add
/long_name (forecast time) def
/pointwidth 5 def
/units (months since 1960-01-01) def
} defasvar

/Forecast_WD5 {
      [ provcode2 | S ]
(/data/simon/WFP/Philippines/%Y%m[S]/Forecasts_wet5_AMJJA_S%Y%m[S].txt) [S]
      readdatafile:
        [3 1] r*8astsv
      :readdatafile
provcode2 provcode SAMPLE
provcode2 gid replaceGRID
        /missing_value -9999. def
        /long_name (WD5 current forecast) def
/units /days def
wetday_freq_colors
DATA 0 AUTO RANGE
    }defasvarsilent
	
	/TercileProb_WD5 {
	[provcode2 C | S ]
(/data/simon/WFP/Philippines/%Y%m[S]/TercileProbs_wet5_AMJJA_S%Y%m[S].txt) [S]
	readdatafile:
	[ 2 1 2] r*8astsv
	:readdatafile
provcode2 provcode SAMPLE
provcode2 gid replaceGRID
	 /long_name (WD5 Tercile Probability) def
	/units /percent def
	/missing_value -1. def
	DATA 0 100 RANGE
	tercileclassesscale
	}defasvarsilent

	
	/PredErrVar_WD5 {
      [ provcode2 | S ]
(/data/simon/WFP/Philippines/%Y%m[S]/PredErrVar_wet5_AMJJA_S%Y%m[S].txt) [S]    
  readdatafile:
        [3 1] r*8astsv
      :readdatafile
provcode2 provcode SAMPLE
provcode2 gid replaceGRID
      /missing_value -9999. def
      /long_name (WD5 prediction error variance) def
      /units /days2 def
wetday_freq_colors
DATA 0 AUTO RANGE
    }defasvarsilent

/DomTercileProb_WD5 {
TercileProb_WD5 
 dup
   [C]dominant_class
   1.0 sub
   11 mul
   exch
   C .gridvalues
    {1 index exch C exch VALUE C removeGRID { (<35) 35 (35-40) 40 (40-45) 45 (45-50) 50 (50-55) 55 (55-60) 60 (60-65) 65 (65-70) 70 (70-75) 75 (75-80) 80 (>80) }classify
[TercileProb_WD5]dominant_class exch}
     forall pop
     3 index
      22 masklt
      add
     0 replaceNaN
     exch
     3 index
      10 12 masknotrange
      add
     0 replaceNaN
     add
    exch
    3 -1 roll
    0 maskgt
    add
   0 replaceNaN
   add
  0 maskle
  /scale_min 1 def
  /scale_max 33 def
  /CLIST[ (<35 Below) (35-40 Below) (40-45 Below) (45-50 Below) (50-55 Below) (55-60 Below) (60-65 Below) (65-70 Below) (70-75 Below) (75-80 Below) (>80 Below) (<35 Normal) (35-40 Normal) (40-45 Normal) (45-50 Normal) (50-55 Normal) (55-60 Normal) (60-65 Normal) (65-70 Normal) (70-75 Normal) (75-80 Normal) (>80 Normal) (<35 Above) (35-40 Above) (40-45 Above) (45-50 Above) (50-55 Above) (55-60 Above) (60-65 Above) (65-70 Above) (70-75 Above) (75-80 Above) (>80 Above) ]def
  startcolormap DATA
    1 33 RANGE
    transparent white white
       1 VALUE
       white white
         2 bandmax
         yellow
          2 VALUE
          red
           11 VALUE
           red red
             12 bandmax
             white white
               13 bandmax
               gray
                13 VALUE
                DimGray
                 22 VALUE
                 DimGray DimGray
                   23 bandmax
                   white white 24
                     bandmax
                     PaleGreen 24
                     VALUE
                     DarkGreen 33
                     VALUE
                     DarkGreen endcolormap
/long_name (WD5 Dominant Tercile Probabilities) def
}defasvar

/the_geom {
SOURCES .Features .Political .Philippines .Provinces
    .the_geom
%     :a: .provcode :a
%    use_as_grid
%   provcode  VoP_IP .provcode 
%SAMPLE
%.gridvalues VALUES
%defivars
%provcode /units /ids def pop
}defasvar

/label {
SOURCES .Features .Political .Philippines .Provinces
    .label
%     :a: .provcode :a
%    use_as_grid
%   provcode VoP_IP .provcode .gridvalues VALUES
%provcode /units /ids def pop
}defasvar

/provname {
SOURCES .Features .Political .Philippines .Provinces
    .provname
%     :a: .provcode :a
%    use_as_grid
%   provcode VoP_IP .provcode .gridvalues VALUES
%provcode /units /ids def pop
}defasvar

/regcode {
SOURCES .Features .Political .Philippines .Provinces
    .regcode
%     :a: .provcode :a
%    use_as_grid
%   provcode VoP_IP .provcode .gridvalues VALUES
%provcode /units /ids def pop
}defasvar	
	
	:dataset
:dataset
 
  
\end{ingrid}
