\begin{ingrid}
continuedataset:
link:
/name (SamplingTable) def
/href (mark/sampleS/M/4/STEP/S/exch%5BM%5Dtable:/mark/:table/.html) def
/description (daily start date (last day of previous month and first 7 days of current month) as a function of ensemble member M and monthly start S) def
:link
grid:
/name (S) def
/calendar /365 def
/units (days since 1960-01-01) def
/standard_name (forecast_reference_time) def
/pointwidth 0 def
%2011 3 10 ymd2d365c 1960 1 1 ymd2d365c sub
2011 2 28 ymd2d365c 1960 1 1 ymd2d365c sub
1
systemtime (%Y %m %d) 12 strftime interp ymd2d365c 1960 1 1 ymd2d365c sub
%2014 11 16 ymd2d365c 1960 1 1 ymd2d365c sub
:grid

S {(/Data/data22/noaa/ncep/cfsv2/fcst/%Y/%m/%d[S]/00/ocnf.01.%Y%m%d[S]00.%Y%m[S].avrg.grib.grb2) [S] } removeextrausing name exch def
/last_modified S .last_modified def
S gridvalues
     npts integerarray copy
     NewGRID
name exch def
S monthlyedgesgrid365 second secondtolast subgrid
/S exch def
S CopyStream defivars
   /name /s365 def
   S monthtimename streamgridunitconvert
   /name /s365 def
name exch def
s365 .S name exch def
grid:
/name (X)def
/units (degree_east)def
 0.0 1.0 359
:grid
grid:
/name (Y)def
/units (degree_north)def
%-89.277000 dup 89.277000 exch sub 190 div exch 89.277000
90 -1 -90
:grid

\end{ingrid}
/T{
currentobject
S
L  exch add nip
/long_name (Forecast Time) def
/standard_name (time) def
/units (months since 1960-01-01) def
/calendar /360 def
/pointwidth 1 def
}defasvarsilent
\begin{ingrid}

/T{
currentobject
S 
%monthlyedgesgrid first secondtolast subgrid
monthlyedgesgrid first last subgrid
 first cvsunits
    interp ensotime
     nip cvi onegridcounter

/units (months since 1960-01-01) def
L  add
[S] regridLB nip
/long_name (Forecast Time) def
/standard_name (time) def
/units (months since 1960-01-01) def
/calendar /360 def
/pointwidth 1 def
}defasvarsilent


dataset: /name /surface def :dataset
dataset: /name /below_sea_level def :dataset
dataset: /name /bottom_of_ocean_mixed_layer def :dataset
dataset: /name /bottom_of_ocean_isothermal_layer def :dataset
dataset: /name /layer_between_2_depths_below_ocean_surface def :dataset
dataset: /name /layer_between_ocean_surface_and_26C_ocean_isothermal_level def :dataset
dataset: /name /isothermal def :dataset

grid:
/name /Z1 def
/long_name (isothermal) def
/units (Kelvin_scale) def
values:
2.5 5 10 15 20 25 28
 :values
:grid

grid:
/name /Z def
/long_name (depth_below_sea_level) def
/units (m) def
values:
4478 3972 3483 3016 2579 2174 1807 1479 1193 949 747 584 459 366 303 262 238 225 215 205 195 185 175 165 155 145 135 125 115 105 95 85 75 65 55 45 35 25 15 5
 :values
:grid

grid:
/name /L def
/units (months) def
0.5 1 9.5
:grid

variable:
/name /offsets def
grids: S :grids
values:
S .npts 12 idiv
%{-20 -21 -19 -20 -20 -21 -21 -22 -23 -23 -24 -19} repeat
{-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1} repeat
S .npts dup 12 idiv 12 imul sub
%{-20 -21 -19 -20 -20 -21 -21 -22 -23 -23 -24 -19} exch 0 exch getinterval
{-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1} exch 0 exch getinterval
aload pop
:values
:variable
/M 32 NewIntegerGRID
name exch def

/M2hour
{ M 1 sub
   4 mod
   6 mul
toi4
/long_name (M2hour) def
} defasvarsilent

variable:
/name /skipM1 def
grids: M :grids
values:
0 0 0 0 1 1 1 1 2 2 2 2 3 3 3 3 4 4 4 4 5 5 5 5 6 6 6 6 7 7 7 7
:values
:variable

/sampleS
{
s365 offsets exch add
skipM1 exch add
M 32 flaggt 
3 index .s365 365 mod 303.5 304.5 flagnotrange mul
1 1 maskrange add
/units (days since 1960-01-01) def
/calendar /365 def
/pointwidth 0 def
} defasvarsilent
/ocean {
[ X Y | /NVZ 222 NewIntegerGRID M L S ] 
%(http://cfs.ncep.noaa.gov/pub/raid0/cfsv2/reforecast.monthly/%Y[sampleS]/%Y[sampleS]%m[sampleS]%d[sampleS]%2.2d[M2hour]/ocnf%Y[sampleS]%m[sampleS]%d[sampleS]%2.2d[M2hour].01.%Y[T]%m[T].avrg.grb2) [M L S M2hour sampleS 0. replaceNaN T ]

(/Data/data22/noaa/ncep/cfsv2/fcst/%Y/%m/%d[sampleS]/%2.2d[M2hour]/ocnf.01.%Y%m%d[sampleS]%2.2d[M2hour].%Y%m[T].avrg.grib.grb2) [ M L S M2hour sampleS 0. replaceNaN T ]

readdatafile: 

/missing_value 9.9990003E+20 def
1 GRIB2record
:readdatafile
2 RECHUNK CopyStream
} defasvarsilent
ocean 1 RECHUNK
definevariables:

below_sea_level 40  Zvariable:/name (POT) def /long_name (Potential Temperature) def /units (Kelvin_scale) def :Zvariable
below_sea_level 40  Zvariable:/name (SALTY) def /long_name (Salinity) def /units (kg kg-1) def :Zvariable
below_sea_level 40  Zvariable:/name (UOGRD) def /long_name (U-Component of Current) def /units (m s-1) def :Zvariable
below_sea_level 40  Zvariable:/name (VOGRD) def /long_name (V-Component of Current) def /units (m s-1) def :Zvariable
below_sea_level 40  Zvariable:/name (DZDT) def /long_name (Vertical Velocity (Geometric)) def /units (m s-1) def :Zvariable
surface 0  Zvariable:/name (UFLX) def /long_name (U-Component of Momentum Flux) def /units (N m-2) def :Zvariable
surface 0  Zvariable:/name (VFLX) def /long_name (V-Component of Momentum Flux) def /units (N m-2) def :Zvariable
surface 0  Zvariable:/name (SSHG) def /long_name (Sea Surface Height Relative to Geoid) def /units (m) def :Zvariable
surface 0  Zvariable:/name (ICEC) def /long_name (Ice Cover) def /units (Proportion) def :Zvariable
surface 0  Zvariable:/name (ICETK) def /long_name (Ice Thickness) def /units (m) def :Zvariable
surface 0  Zvariable:/name (SNOD) def /long_name (Snow Depth) def /units (m) def :Zvariable
surface 0  Zvariable:/name (TMP) def /long_name (Temperature) def /units (Kelvin_scale) def /missing_value 0. def :Zvariable
surface 0  Zvariable:/name (UICE) def /long_name (U-component of Ice Drift) def /units (m s-1) def :Zvariable
surface 0  Zvariable:/name (VICE) def /long_name (V-component of Ice Drift) def /units (m s-1) def :Zvariable
surface 0  Zvariable:/name (EMNP) def /long_name (Evaporation - Precipitation) def /units (cm/day) def :Zvariable
surface 0  Zvariable:/name (THFLX) def /long_name (Total Downward Heat Flux at Surface) def /units (W m-2) def :Zvariable
bottom_of_ocean_mixed_layer 0  Zvariable:/name (DBSS) def /long_name (Geometric Depth Below Sea Surface) def /units (m) def :Zvariable
bottom_of_ocean_isothermal_layer 0  Zvariable:/name (DBSS) def /long_name (Geometric Depth Below Sea Surface) def /units (m) def :Zvariable
layer_between_2_depths_below_ocean_surface 0  Zvariable:/name (OHC) def /long_name (Ocean Heat Content) def /units (J m-2) def :Zvariable
layer_between_ocean_surface_and_26C_ocean_isothermal_level 0  Zvariable:/name (TCHP) def /long_name (Tropical Cyclone Heat Potential) def /units (J m-2 Kelvin_scale-1) def :Zvariable
/Z Z1 def
isothermal 7 Zvariable:/name (DBSS) def /long_name (Geometric Depth Below Sea Surface) def /units (m) def :Zvariable

:definevariables
/ocean undef
\end{ingrid}
\begin{ingrid}
surface /TMP 
{null decompress} dup 3 index 3 index get 0 exch put put
:dataset
%surface /TMP cachesomevar
%pop
\end{ingrid}
