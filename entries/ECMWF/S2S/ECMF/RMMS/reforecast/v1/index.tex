\begin{ingrid}
continuedataset:

datasetdefs:
grid:
   /name /Smod def
   0 3.5 52
   % the end year here must be one year more than the current year (i.e. use 2020 once 2019 has arrived as the start year in the S grid)
   7 mul
   systemtime systemtime2ymd pop
   pop
   1 add
   2015 sub mul


:grid
:datasetdefs

\end{ingrid}

grid:
%This definition is needed for making specific time steps, first, we create an S grid standard then modify it for the right time step
/name (S) def
/units (days since 1960-01-01) def
/long_name (forecast start time) def
/standard_name (forecast_reference_time) def
%01 Jan 2015 julian_day 01 Jan 1960 julian_day sub
14 May 2015 julian_day 01 Jan 1960 julian_day sub
1.0
11 Nov 2024 julian_day
01 Jan 1960 julian_day sub
/pointwidth 0. def
/defaultvalue { last } def
:grid

\begin{ingrid}

  /S Smod
    0 add
    7 mod
    0 maskgt
    Smod add
    Smod
     0.5 add
     replaceNaN
    /name /S def
    Smod
     0 add
     /name /Smod2 def
     exch use_as_grid
    .S
    /units (days since 2015-01-01) def
    /pointwidth 0 def
     dup
     (days since 1960-01-01) streamgridunitconvert
    /long_name (forecast start time) def
    /standard_name (forecast_reference_time) def
    /defaultvalue {last}def
    def

     S dup 14
     May 2015 julian_day
     01
      Jan 1960 julian_day
      sub
      11 Nov 2024 julian_day
      01 Jan 1960 julian_day sub
     subgrid
    replaceGRID


grid:
/name /hdate def
/units (months since 1960-01-01) def
01 Jul 1995 ensotime
12.0
% hdate must be one less year than the current year
01 Jul 2023 ensotime
/defaultvalue { last } def
:grid

grid:
/name /L def
/long_name (Lead) def
/standard_name (forecast_period) def
/units (days) def
1. 1. 46.
/pointwidth 0. def
:grid

\end{ingrid}
grid:
/name /L def
/long_name (Lead) def
/standard_name (forecast_period) def
/units (days) def
1. 1. 32.
/pointwidth 0. def
:grid
\begin{ingrid}

grid:
/name /M def
/long_name (Ensemble Member) def
/standard_name (realization) def
/units (ids) def
0 1 10
:grid

dataset:
/name (ensembles) def

[ M L S hdate ] {name exch def } forall

 /RMM1 { [ M L | S hdate ] 
 (/Data/data25/ECMWF/S2S/ECMF/REF/RMMS/%Y[S]/%m[S]/z_s2s_rmm_ecmf_prod_rf_%Y[hdate]%m%d[S]00_%Y%m%d[S].txt) [ S hdate ]
readdatafile:
((/,45(/,11(11X,F6.3,/)),(/,10(11X,F6.3,/),(11X,F6.3)))) formatted
:readdatafile
/missing_value -999 def
/long_name (RMM1) def
/units (unitless) def
} defasvarsilent

 /RMM2 { [ M L | S hdate ] 
 (/Data/data25/ECMWF/S2S/ECMF/REF/RMMS/%Y[S]/%m[S]/z_s2s_rmm_ecmf_prod_rf_%Y[hdate]%m%d[S]00_%Y%m%d[S].txt) [ S hdate ]
 readdatafile:
 ((/,45(/,11(18X,F6.3,/)),(/,10(18X,F6.3,/),(18X,F6.3)))) formatted
 :readdatafile
 /missing_value -999 def
 /long_name (RMM2) def
 /units (unitless) def
 } defasvarsilent

 /amplitude { [ M L | S hdate ]
 (/Data/data25/ECMWF/S2S/ECMF/REF/RMMS/%Y[S]/%m[S]/z_s2s_rmm_ecmf_prod_rf_%Y[hdate]%m%d[S]00_%Y%m%d[S].txt) [ S hdate ]
 readdatafile:
 ((/,45(/,11(25X,F6.3,/)),(/,10(25X,F6.3,/),(25X,F6.3)))) formatted
 :readdatafile
 /missing_value -999 def
 /long_name (amplitude) def
 /units (unitless) def
 } defasvarsilent

 /phase { [ M L | S hdate ]
 (/Data/data25/ECMWF/S2S/ECMF/REF/RMMS/%Y[S]/%m[S]/z_s2s_rmm_ecmf_prod_rf_%Y[hdate]%m%d[S]00_%Y%m%d[S].txt) [ S hdate ]
 readdatafile:
 ((/,45(/,11(32X,F1.0,/)),(/,10(32X,F1.0,/),(32X,F1.0)))) formatted
 :readdatafile
 /missing_value -999 def
 /long_name (phase) def
 /units (unitless) def
 } defasvarsilent
:dataset

dataset:
/name (ensemble_mean) def

[ L S hdate ] {name exch def } forall

 /RMM1 { [ L | S hdate ] 
 (/Data/data25/ECMWF/S2S/ECMF/REF/RMMS/%Y[S]/%m[S]/z_s2s_rmm_ecmf_prod_rf_%Y[hdate]%m%d[S]00_%Y%m%d[S].txt) [ S hdate ]
 readdatafile:
 ((/,45(11X,F6.3,12(/)),(11X,F6.3))) formatted
 :readdatafile
 /missing_value -999 def
 /long_name (RMM1) def
 /units (unitless) def
 } defasvarsilent

 /RMM2 { [ L | S hdate ]
 (/Data/data25/ECMWF/S2S/ECMF/REF/RMMS/%Y[S]/%m[S]/z_s2s_rmm_ecmf_prod_rf_%Y[hdate]%m%d[S]00_%Y%m%d[S].txt) [ S hdate ]
 readdatafile:
 ((/,45(18X,F6.3,12(/)),(18X,F6.3))) formatted
 :readdatafile
 /missing_value -999 def
 /long_name (RMM2) def
 /units (unitless) def
 } defasvarsilent

 /amplitude { [ L | S hdate ] 
 (/Data/data25/ECMWF/S2S/ECMF/REF/RMMS/%Y[S]/%m[S]/z_s2s_rmm_ecmf_prod_rf_%Y[hdate]%m%d[S]00_%Y%m%d[S].txt) [ S hdate ]
 readdatafile:
 /missing_value -999 def
 ((/,45(25X,F6.3,12(/)),(25X,F6.3))) formatted
 :readdatafile
 /long_name (amplitude) def
 /units (unitless) def
 } defasvarsilent

 /phase { [ L | S hdate ] 
 (/Data/data25/ECMWF/S2S/ECMF/REF/RMMS/%Y[S]/%m[S]/z_s2s_rmm_ecmf_prod_rf_%Y[hdate]%m%d[S]00_%Y%m%d[S].txt) [ S hdate ]
 readdatafile:
 /missing_value -999 def
 ((/,45(32X,F1.0,12(/)),(32X,F1.0))) formatted
 :readdatafile
 /long_name (phase) def
 /units (unitless) def
 } defasvarsilent

:dataset

:dataset
\end{ingrid}
