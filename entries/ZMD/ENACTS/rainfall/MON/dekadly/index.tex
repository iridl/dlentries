\begin{ingrid}
% First statement for Ingrid

% New dataset
continuedataset:

% Time Grid 
%datasetdefs:
/T
1 Jan 1983 julian_day
31 Dec 2014 julian_day
dekadGRID
/defaultvalue {last} def
def
%:datasetdefs

% Longitude Grid 
grid:
/name /X def
/units (degree_east) def
/long_name (Longitude) def 
21.01875 0.0375 33.95625
:grid

% Latitude Grid 
grid: 
/name /Y def 
/units (degree_north) def
/long_name (Latitude) def 
-18.98125 0.0375 -8.03125
:grid

% Rainfall Variable
/rfe_merged {
[X Y | T]
(/data/ikh/data/tufa20150623/rr/rr_mrg_%Y[T]%m[T]%d[dekad].nc)
[T dup day2dom 5. add 10. div toi4 /name /dekad def ]

readdatafile:
/shortarraytype netcdfrecords
%/missing_value -9999. def 
/units /mm def
/name (precip) def
/long_name (Merged Station-Satellite Rainfall) def
:readdatafile
%cmorph_dekad_colors
startcolormap transparent DarkRed DarkRed red OrangeRed DarkOrange LightSalmon yellow LemonChiffon LightYellow LightCyan cyan SteelBlue RoyalBlue MediumBlue MediumBlue endcolormap
DATA 0 AUTO RANGE
}defasvarsilent

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Standard Precipitation Index for dekadal precipitation
/SPI-rfe_merged_1-dekad { 
rfe_merged
  1 36 gamma3par
  pcpn_accum gmean gsd gskew pzero 1 gammaprobs
  1 gammastandardize
  /long_name (Standard Precipitation Index 1-dekad) def 
}defasvarsilent 

% Dekadal anomalies from dekadal climatologies
/rfe_mergeddiff { 
  rfe_merged
  SOURCES .ZMD .ENACTS .rainfall .MON .dekadly .climatologies .rfe_merged
   T 2 index .T 
     a: .first cvsunits
       :a: .last cvsunits :a
      RANGE
   T 2 index .T replaceGRID
   sub 

% Colorscale for dekadal anomalies
startcolormap -150 150 RANGE
transparent sienna
sienna -150 VALUE
sienna sienna -100 bandmax
peru peru -50 bandmax
burlywood burlywood -25 bandmax
wheat wheat -5 bandmax
LightYellow LightYellow 5 bandmax
LightCyan LightCyan 25 bandmax
PaleTurquoise PaleTurquoise 50 bandmax
MediumAquamarine MediumAquamarine 100 bandmax
CadetBlue CadetBlue 150 bandmax
CadetBlue
endcolormap

/long_name (Merged Station-Satellite Rainfall Anomaly) def

}defasvarsilent

%Difference between rfe data and its climatology
/rfe_mergeddiff_percent {

  rfe_merged
  SOURCES .ZMD .ENACTS .rainfall .MON .dekadly .climatologies .rfe_merged
   T 2 index .T
     a: .first cvsunits
       :a: .last cvsunits :a
      RANGE
   T 2 index .T replaceGRID
   sub
  SOURCES .ZMD .ENACTS .rainfall .MON .dekadly .climatologies .rfe_merged
   10 maskle
   T 2 index .T
     a: .first cvsunits
       :a: .last cvsunits :a
      RANGE
   T 2 index .T replaceGRID
   div
%  100 mul
/percent unitconvert
  -1000 replaceNaN

% Colorscale for rfe differences
startcolormap
    -100 500 RANGE
    LightSteelBlue ivory SaddleBrown
       -100 VALUE
       SaddleBrown SaddleBrown
         -60 bandmax
         peru peru
           -40 bandmax
           burlywood burlywood
             -20 bandmax
             wheat wheat
               0 bandmax
               LightCyan LightCyan
                 40 bandmax
                 aquamarine aquamarine
                   90 bandmax
                   MediumAquamarine MediumAquamarine 160
                     bandmax
                     MediumSeaGreen MediumSeaGreen 240
                     bandmax
                     SeaGreen SeaGreen 350
                     bandmax
                     DarkSeaGreen DarkSeaGreen 500
                     bandmax
                     DarkSeaGreen endcolormap
  /long_name (Merged Station-Satellite Rainfall Difference Expressed as Percent of Long-Term Average (%)) def
}defasvar

/rfe_merged_vs_meanrfe {
  rfe_merged
  SOURCES .ZMD .ENACTS .rainfall .MON .dekadly .climatologies .rfe_merged
   7 maskle
   T 2 index .T
     a: .first cvsunits
       :a: .last cvsunits :a
      RANGE
   T 2 index .T replaceGRID
   div
%  100 mul
/percent unitconvert
  -1000 replaceNaN

% Colorscale for rfe percentages
startcolormap
    0 600 RANGE
    LightSteelBlue ivory SaddleBrown
       0 VALUE
       SaddleBrown SaddleBrown
         50 bandmax
         peru peru
           100 bandmax
           burlywood burlywood
             150 bandmax
             wheat wheat
               200 bandmax
               LightCyan LightCyan
                 300 bandmax
                 aquamarine aquamarine
                   350 bandmax
                   MediumAquamarine MediumAquamarine 400
                     bandmax
                     MediumSeaGreen MediumSeaGreen 450
                     bandmax
                     SeaGreen SeaGreen 500
                     bandmax
                     DarkSeaGreen DarkSeaGreen 600
                     bandmax
                     DarkSeaGreen endcolormap
  /long_name (Merged Station-Satellite Rainfall Expressed as Percentages of the Long-Term Average) def
}defasvar

:dataset

\end{ingrid}


